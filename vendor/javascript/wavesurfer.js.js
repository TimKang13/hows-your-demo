// wavesurfer.js@7.11.1 downloaded from https://ga.jspm.io/npm:wavesurfer.js@7.11.1/dist/wavesurfer.esm.js

function t(t,i,n,s){return new(n||(n=Promise))((function(r,o){function h(t){try{c(s.next(t))}catch(t){o(t)}}function l(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var i;t.done?r(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(h,l)}c((s=s.apply(t,i||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(){this.listeners={}}on(t,i,n){if(this.listeners[t]||(this.listeners[t]=new Set),null==n?void 0:n.once){const n=(...s)=>{this.un(t,n),i(...s)};return this.listeners[t].add(n),()=>this.un(t,n)}return this.listeners[t].add(i),()=>this.un(t,i)}un(t,i){var n;null===(n=this.listeners[t])||void 0===n||n.delete(i)}once(t,i){return this.on(t,i,{once:!0})}unAll(){this.listeners={}}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach((t=>t(...i)))}}const i={decode:function(i,n){return t(this,void 0,void 0,(function*(){const t=new AudioContext({sampleRate:n});try{return yield t.decodeAudioData(i)}finally{t.close()}}))},createBuffer:function(t,i){if(!t||0===t.length)throw new Error("channelData must be a non-empty array");if(i<=0)throw new Error("duration must be greater than 0");if("number"==typeof t[0]&&(t=[t]),!t[0]||0===t[0].length)throw new Error("channelData must contain non-empty channel arrays");!function(t){const i=t[0];if(i.some((t=>t>1||t<-1))){const n=i.length;let s=0;for(let t=0;t<n;t++){const n=Math.abs(i[t]);n>s&&(s=n)}for(const i of t)for(let t=0;t<n;t++)i[t]/=s}}(t);const n=t.map((t=>t instanceof Float32Array?t:Float32Array.from(t)));return{duration:i,length:n[0].length,sampleRate:n[0].length/i,numberOfChannels:n.length,getChannelData:t=>{const i=n[t];if(!i)throw new Error(`Channel ${t} not found`);return i},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function n(t,i){const s=i.xmlns?document.createElementNS(i.xmlns,t):document.createElement(t);for(const[t,r]of Object.entries(i))if("children"===t&&r)for(const[t,i]of Object.entries(r))i instanceof Node?s.appendChild(i):"string"==typeof i?s.appendChild(document.createTextNode(i)):s.appendChild(n(t,i));else"style"===t?Object.assign(s.style,r):"textContent"===t?s.textContent=r:s.setAttribute(t,r.toString());return s}function s(t,i,s){const r=n(t,i||{});return null==s||s.appendChild(r),r}var r=Object.freeze({__proto__:null,createElement:s,default:s});const o={fetchBlob:function(i,n,s){return t(this,void 0,void 0,(function*(){const r=yield fetch(i,s);if(r.status>=400)throw new Error(`Failed to fetch ${i}: ${r.status} (${r.statusText})`);return function(i,n){t(this,void 0,void 0,(function*(){if(!i.body||!i.headers)return;const t=i.body.getReader(),s=Number(i.headers.get("Content-Length"))||0;let r=0;const o=t=>{r+=(null==t?void 0:t.length)||0;const i=Math.round(r/s*100);n(i)};try{for(;;){const i=yield t.read();if(i.done)break;o(i.value)}}catch(t){console.warn("Progress tracking error:",t)}}))}(r.clone(),n),r.blob()}))}};class a extends e{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),null!=t.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=t.playbackRate&&(this.media.playbackRate=t.playbackRate)}),{once:!0})}onMediaEvent(t,i,n){return this.media.addEventListener(t,i,n),()=>this.media.removeEventListener(t,i,n)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return""!==this.media.canPlayType(t)}setSrc(t,i){const n=this.getSrc();if(t&&n===t)return;this.revokeSrc();const s=i instanceof Blob&&(this.canPlayType(i.type)||!t)?URL.createObjectURL(i):t;if(n&&this.media.removeAttribute("src"),s||t)try{this.media.src=s}catch(i){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(t){this.media=t}play(){return t(this,void 0,void 0,(function*(){try{return yield this.media.play()}catch(t){if(t instanceof DOMException&&"AbortError"===t.name)return;throw t}}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,i){null!=i&&(this.media.preservesPitch=i),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}function h(t){return t<0?0:t>1?1:t}function l({maxTop:t,maxBottom:i,halfHeight:n,vScale:s}){const r=Math.round(t*n*s);return{topHeight:r,totalHeight:r+Math.round(i*n*s)||1}}function c({barAlign:t,halfHeight:i,topHeight:n,totalHeight:s,canvasHeight:r}){return"top"===t?0:"bottom"===t?r-s:i-n}function d(t,i,n){const s=i-t.left,r=n-t.top;return[s/t.width,r/t.height]}function u(t){return Boolean(t.barWidth||t.barGap||t.barAlign)}function p(t,i){if(!u(i))return t;const n=i.barWidth||.5,s=n+(i.barGap||n/2);return 0===s?t:Math.floor(t/s)*s}function m({scrollLeft:t,totalWidth:i,numCanvases:n}){if(0===i)return[0];const s=t/i,r=Math.floor(s*n);return[r-1,r,r+1]}function f({scrollLeft:t,clientWidth:i,scrollWidth:n}){return 0===n?{startX:0,endX:0}:{startX:t/n,endX:(t+i)/n}}class g extends e{constructor(t,i){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=t;const n=this.parentFromOptionsContainer(t.container);this.parent=n;const[s,r]=this.initHtml();n.appendChild(s),this.container=s,this.scrollContainer=r.querySelector(".scroll"),this.wrapper=r.querySelector(".wrapper"),this.canvasWrapper=r.querySelector(".canvases"),this.progressWrapper=r.querySelector(".progress"),this.cursor=r.querySelector(".cursor"),i&&r.appendChild(i),this.initEvents()}parentFromOptionsContainer(t){let i;if("string"==typeof t?i=document.querySelector(t):t instanceof HTMLElement&&(i=t),!i)throw new Error("Container not found");return i}initEvents(){if(this.wrapper.addEventListener("click",(t=>{const i=this.wrapper.getBoundingClientRect(),[n,s]=d(i,t.clientX,t.clientY);this.emit("click",n,s)})),this.wrapper.addEventListener("dblclick",(t=>{const i=this.wrapper.getBoundingClientRect(),[n,s]=d(i,t.clientX,t.clientY);this.emit("dblclick",n,s)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:t,scrollWidth:i,clientWidth:n}=this.scrollContainer,{startX:s,endX:r}=f({scrollLeft:t,scrollWidth:i,clientWidth:n});this.emit("scroll",s,r,t,t+n)})),"function"==typeof ResizeObserver){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{t().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=t,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=function(t,i,n,s,r=3,o=0,h=100){if(!t)return()=>{};const l=new Map,c=matchMedia("(pointer: coarse)").matches;let d=()=>{};const u=u=>{if(u.button!==o)return;if(l.set(u.pointerId,u),l.size>1)return;let p=u.clientX,m=u.clientY,f=!1;const y=Date.now(),w=s=>{if(s.defaultPrevented||l.size>1)return;if(c&&Date.now()-y<h)return;const o=s.clientX,d=s.clientY,u=o-p,w=d-m;if(f||Math.abs(u)>r||Math.abs(w)>r){s.preventDefault(),s.stopPropagation();const r=t.getBoundingClientRect(),{left:h,top:l}=r;f||(null==n||n(p-h,m-l),f=!0),i(u,w,o-h,d-l),p=o,m=d}},S=i=>{if(l.delete(i.pointerId),f){const n=i.clientX,r=i.clientY,o=t.getBoundingClientRect(),{left:h,top:l}=o;null==s||s(n-h,r-l)}d()},x=t=>{l.delete(t.pointerId),t.relatedTarget&&t.relatedTarget!==document.documentElement||S(t)},E=t=>{f&&(t.stopPropagation(),t.preventDefault())},P=t=>{t.defaultPrevented||l.size>1||f&&t.preventDefault()};document.addEventListener("pointermove",w),document.addEventListener("pointerup",S),document.addEventListener("pointerout",x),document.addEventListener("pointercancel",x),document.addEventListener("touchmove",P,{passive:!1}),document.addEventListener("click",E,{capture:!0}),d=()=>{document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",S),document.removeEventListener("pointerout",x),document.removeEventListener("pointercancel",x),document.removeEventListener("touchmove",P),setTimeout((()=>{document.removeEventListener("click",E,{capture:!0})}),10)}};return t.addEventListener("pointerdown",u),()=>{d(),t.removeEventListener("pointerdown",u),l.clear()}}(this.wrapper,((t,i,n)=>{const s=this.wrapper.getBoundingClientRect().width;this.emit("drag",h(n/s))}),(t=>{this.isDragging=!0;const i=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",h(t/i))}),(t=>{this.isDragging=!1;const i=this.wrapper.getBoundingClientRect().width;this.emit("dragend",h(t/i))})),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){const t=document.createElement("div"),i=t.attachShadow({mode:"open"}),n=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return i.innerHTML=`\n      <style${n?` nonce="${n}"`:""}>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n          pointer-events: none;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[t,i]}setOptions(t){if(this.options.container!==t.container){const i=this.parentFromOptionsContainer(t.container);i.appendChild(this.container),this.parent=i}!0!==t.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:i}=this.scrollContainer,n=i*t;this.setScroll(n)}destroy(){var t;this.subscriptions.forEach((t=>t())),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null===(t=this.unsubscribeOnScroll)||void 0===t||t.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(t=10){let i,n;const s=()=>{i&&(clearTimeout(i),i=void 0),n&&(n(),n=void 0)};return this.timeouts.push(s),()=>new Promise(((r,o)=>{s(),n=o,i=setTimeout((()=>{i=void 0,n=void 0,r()}),t)}))}getHeight(t,i){var n;const s=(null===(n=this.audioData)||void 0===n?void 0:n.numberOfChannels)||1;return function({optionsHeight:t,optionsSplitChannels:i,parentHeight:n,numberOfChannels:s,defaultHeight:r=128}){if(null==t)return r;const o=Number(t);if(!isNaN(o))return o;if("auto"===t){const t=n||r;return(null==i?void 0:i.every((t=>!t.overlay)))?t/s:t}return r}({optionsHeight:t,optionsSplitChannels:i,parentHeight:this.parent.clientHeight,numberOfChannels:s,defaultHeight:128})}convertColorValues(t){return function(t,i){if(!Array.isArray(t))return t||"";if(0===t.length)return"#999";if(t.length<2)return t[0]||"";const n=document.createElement("canvas"),s=n.getContext("2d"),r=n.height*i,o=s.createLinearGradient(0,0,0,r||i),h=1/(t.length-1);return t.forEach(((t,i)=>{o.addColorStop(i*h,t)})),o}(t,this.getPixelRatio())}getPixelRatio(){return t=window.devicePixelRatio,Math.max(1,t||1);var t}renderBarWaveform(t,i,n,s){const{width:r,height:o}=n.canvas,{halfHeight:h,barWidth:d,barRadius:u,barIndexScale:p,barSpacing:m}=function({width:t,height:i,length:n,options:s,pixelRatio:r}){const o=i/2,h=s.barWidth?s.barWidth*r:1,l=s.barGap?s.barGap*r:s.barWidth?h/2:0,c=h+l||1;return{halfHeight:o,barWidth:h,barGap:l,barRadius:s.barRadius||0,barIndexScale:n>0?t/c/n:0,barSpacing:c}}({width:r,height:o,length:(t[0]||[]).length,options:i,pixelRatio:this.getPixelRatio()}),f=function({channelData:t,barIndexScale:i,barSpacing:n,barWidth:s,halfHeight:r,vScale:o,canvasHeight:h,barAlign:d}){const u=t[0]||[],p=t[1]||u,m=u.length,f=[];let y=0,w=0,S=0;for(let t=0;t<=m;t++){const m=Math.round(t*i);if(m>y){const{topHeight:t,totalHeight:i}=l({maxTop:w,maxBottom:S,halfHeight:r,vScale:o}),u=c({barAlign:d,halfHeight:r,topHeight:t,totalHeight:i,canvasHeight:h});f.push({x:y*n,y:u,width:s,height:i}),y=m,w=0,S=0}const x=Math.abs(u[t]||0),E=Math.abs(p[t]||0);x>w&&(w=x),E>S&&(S=E)}return f}({channelData:t,barIndexScale:p,barSpacing:m,barWidth:d,halfHeight:h,vScale:s,canvasHeight:o,barAlign:i.barAlign});n.beginPath();for(const t of f)u&&"roundRect"in n?n.roundRect(t.x,t.y,t.width,t.height,u):n.rect(t.x,t.y,t.width,t.height);n.fill(),n.closePath()}renderLineWaveform(t,i,n,s){const{width:r,height:o}=n.canvas,h=function({channelData:t,width:i,height:n,vScale:s}){const r=n/2,o=t[0]||[];return[o,t[1]||o].map(((t,n)=>{const o=t.length,h=o?i/o:0,l=r,c=0===n?-1:1,d=[{x:0,y:l}];let u=0,p=0;for(let i=0;i<=o;i++){const n=Math.round(i*h);if(n>u){const t=l+(Math.round(p*r*s)||1)*c;d.push({x:u,y:t}),u=n,p=0}const o=Math.abs(t[i]||0);o>p&&(p=o)}return d.push({x:u,y:l}),d}))}({channelData:t,width:r,height:o,vScale:s});n.beginPath();for(const t of h)if(t.length){n.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i++){const s=t[i];n.lineTo(s.x,s.y)}}n.fill(),n.closePath()}renderWaveform(t,i,n){if(n.fillStyle=this.convertColorValues(i.waveColor),i.renderFunction)return void i.renderFunction(t,n);const s=function({channelData:t,barHeight:i,normalize:n}){var s;const r=i||1;if(!n)return r;const o=t[0];if(!o||0===o.length)return r;let h=0;for(let t=0;t<o.length;t++){const i=null!==(s=o[t])&&void 0!==s?s:0,n=Math.abs(i);n>h&&(h=n)}return h?r/h:r}({channelData:t,barHeight:i.barHeight,normalize:i.normalize});u(i)?this.renderBarWaveform(t,i,n,s):this.renderLineWaveform(t,i,n,s)}renderSingleCanvas(t,i,n,s,r,o,h){const l=this.getPixelRatio(),c=document.createElement("canvas");c.width=Math.round(n*l),c.height=Math.round(s*l),c.style.width=`${n}px`,c.style.height=`${s}px`,c.style.left=`${Math.round(r)}px`,o.appendChild(c);const d=c.getContext("2d");if(i.renderFunction?(d.fillStyle=this.convertColorValues(i.waveColor),i.renderFunction(t,d)):this.renderWaveform(t,i,d),c.width>0&&c.height>0){const t=c.cloneNode(),n=t.getContext("2d");n.drawImage(c,0,0),n.globalCompositeOperation="source-in",n.fillStyle=this.convertColorValues(i.progressColor),n.fillRect(0,0,c.width,c.height),h.appendChild(t)}}renderMultiCanvas(t,i,n,s,r,o){const h=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,c=n/h,d=function({clientWidth:t,totalWidth:i,options:n}){return p(Math.min(8e3,t,i),n)}({clientWidth:l,totalWidth:c,options:i});let u={};if(0===d)return;const f=n=>{if(n<0||n>=y)return;if(u[n])return;u[n]=!0;const h=n*d;let l=Math.min(c-h,d);if(l=p(l,i),l<=0)return;const m=function({channelData:t,offset:i,clampedWidth:n,totalWidth:s}){return t.map((t=>{const r=Math.floor(i/s*t.length),o=Math.floor((i+n)/s*t.length);return t.slice(r,o)}))}({channelData:t,offset:h,clampedWidth:l,totalWidth:c});this.renderSingleCanvas(m,i,l,s,h,r,o)},y=Math.ceil(c/d);if(this.isScrollable){if(m({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:c,numCanvases:y}).forEach((t=>f(t))),y>1){const t=this.on("scroll",(()=>{const{scrollLeft:t}=this.scrollContainer;Object.keys(u).length>10&&(r.innerHTML="",o.innerHTML="",u={}),m({scrollLeft:t,totalWidth:c,numCanvases:y}).forEach((t=>f(t)))}));this.unsubscribeOnScroll.push(t)}}else for(let t=0;t<y;t++)f(t)}renderChannel(t,i,n,s){var{overlay:r}=i,o=function(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)i.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]])}return n}(i,["overlay"]);const h=document.createElement("div"),l=this.getHeight(o.height,o.splitChannels);h.style.height=`${l}px`,r&&s>0&&(h.style.marginTop=`-${l}px`),this.canvasWrapper.style.minHeight=`${l}px`,this.canvasWrapper.appendChild(h);const c=h.cloneNode();this.progressWrapper.appendChild(c),this.renderMultiCanvas(t,o,n,l,h,c)}render(i){return t(this,void 0,void 0,(function*(){var t;this.timeouts.forEach((t=>t())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const n=this.getPixelRatio(),s=this.scrollContainer.clientWidth,{scrollWidth:r,isScrollable:o,useParentWidth:h,width:l}=function({duration:t,minPxPerSec:i=0,parentWidth:n,fillParent:s,pixelRatio:r}){const o=Math.ceil(t*i),h=o>n,l=Boolean(s&&!h);return{scrollWidth:o,isScrollable:h,useParentWidth:l,width:(l?n:o)*r}}({duration:i.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:s,fillParent:this.options.fillParent,pixelRatio:n});if(this.isScrollable=o,this.wrapper.style.width=h?"100%":`${r}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=i,this.emit("render"),this.options.splitChannels)for(let n=0;n<i.numberOfChannels;n++){const s=Object.assign(Object.assign({},this.options),null===(t=this.options.splitChannels)||void 0===t?void 0:t[n]);this.renderChannel([i.getChannelData(n)],s,l,n)}else{const t=[i.getChannelData(0)];i.numberOfChannels>1&&t.push(i.getChannelData(1)),this.renderChannel(t,this.options,l,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((t=>t())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:t}=this.scrollContainer,{right:i}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){const{right:t}=this.progressWrapper.getBoundingClientRect(),n=function(t){const i=2*t;return(i<0?Math.floor(i):Math.ceil(i))/2}(t-i);this.scrollContainer.scrollLeft+=n}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,i=!1){const{scrollLeft:n,scrollWidth:s,clientWidth:r}=this.scrollContainer,o=t*s,h=n,l=n+r,c=r/2;if(this.isDragging){const t=30;o+t>l?this.scrollContainer.scrollLeft+=t:o-t<h&&(this.scrollContainer.scrollLeft-=t)}else{(o<h||o>l)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?c:0));const t=o-n-c;i&&this.options.autoCenter&&t>0&&(this.scrollContainer.scrollLeft+=t)}{const t=this.scrollContainer.scrollLeft,{startX:i,endX:n}=f({scrollLeft:t,scrollWidth:s,clientWidth:r});this.emit("scroll",i,n,t,t+r)}}renderProgress(t,i){if(isNaN(t))return;const n=100*t;this.canvasWrapper.style.clipPath=`polygon(${n}% 0%, 100% 0%, 100% 100%, ${n}% 100%)`,this.progressWrapper.style.width=`${n}%`,this.cursor.style.left=`${n}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${t*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,i)}exportImage(i,n,s){return t(this,void 0,void 0,(function*(){const t=this.canvasWrapper.querySelectorAll("canvas");if(!t.length)throw new Error("No waveform data");if("dataURL"===s){const s=Array.from(t).map((t=>t.toDataURL(i,n)));return Promise.resolve(s)}return Promise.all(Array.from(t).map((t=>new Promise(((s,r)=>{t.toBlob((t=>{t?s(t):r(new Error("Could not export image"))}),i,n)})))))}))}}class v extends e{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class b extends e{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return t(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((i=>{if(i.status>=400)throw new Error(`Failed to fetch ${t}: ${i.status} (${i.statusText})`);return i.arrayBuffer()})).then((i=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(i))).then((i=>{this.currentSrc===t&&(this.buffer=i,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})).catch((t=>{console.error("WebAudioPlayer load error:",t)}))}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,null===(t=this.bufferNode)||void 0===t||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){const i=t-this.currentTime,n=this.bufferNode;null==n||n.stop(this.audioContext.currentTime+i),null==n||n.addEventListener("ended",(()=>{n===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(i){return t(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(i)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const i=!this.paused;i&&this._pause(),this.playedDuration=t/this._playbackRate,i&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,i;return null!==(t=this._duration)&&void 0!==t?t:(null===(i=this.buffer)||void 0===i?void 0:i.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const i=this.buffer.numberOfChannels;for(let n=0;n<i;n++)t.push(this.buffer.getChannelData(n));return t}removeAttribute(t){switch(t){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const y={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class C extends a{static create(t){return new C(t)}constructor(t){const i=t.media||("WebAudio"===t.backend?new b:void 0);super({media:i,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},y,t),this.timer=new v;const n=i?void 0:this.getMediaElement();this.renderer=new g(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const s=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:t,duration:i}=this.options;(s||t&&i)&&this.load(s,t,i).catch((t=>{this.emit("error",t instanceof Error?t:new Error(String(t)))}))}))}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),null!=this.stopAtPosition&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const t=this.updateProgress();this.emit("timeupdate",t)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var t;this.emit("error",null!==(t=this.getMediaElement().error)&&void 0!==t?t:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((t,i)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,i))})),this.renderer.on("dblclick",((t,i)=>{this.emit("dblclick",t,i)})),this.renderer.on("scroll",((t,i,n,s)=>{const r=this.getDuration();this.emit("scroll",t*r,i*r,n,s)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(t=>{this.emit("dragstart",t)})),this.renderer.on("dragend",(t=>{this.emit("dragend",t)})),this.renderer.on("resize",(()=>{this.emit("resize")})));{let t;const i=this.renderer.on("drag",(i=>{var n;if(!this.options.interact)return;this.renderer.renderProgress(i),clearTimeout(t);let s=0;const r=this.options.dragToSeek;this.isPlaying()?s=0:!0===r?s=200:r&&"object"==typeof r&&(s=null!==(n=r.debounceTime)&&void 0!==n?n:200),t=setTimeout((()=>{this.seekTo(i)}),s),this.emit("interaction",i*this.getDuration()),this.emit("drag",i)}));this.subscriptions.push((()=>{clearTimeout(t),i()}))}}initPlugins(){var t;(null===(t=this.options.plugins)||void 0===t?void 0:t.length)&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t=>t())),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=i.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=i.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),null!=t.mediaControls&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){if(this.plugins.includes(t))return t;t._init(this),this.plugins.push(t);const i=t.once("destroy",(()=>{this.plugins=this.plugins.filter((i=>i!==t)),this.subscriptions=this.subscriptions.filter((t=>t!==i))}));return this.subscriptions.push(i),t}unregisterPlugin(t){this.plugins=this.plugins.filter((i=>i!==t)),t.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const i=t/this.getDuration();this.renderer.setScrollPercentage(i)}getActivePlugins(){return this.plugins}loadAudio(n,s,r,h){return t(this,void 0,void 0,(function*(){var t;if(this.emit("load",n),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,null===(t=this.abortController)||void 0===t||t.abort(),this.abortController=null,!s&&!r){const t=this.options.fetchParams||{};window.AbortController&&!t.signal&&(this.abortController=new AbortController,t.signal=this.abortController.signal);const i=t=>this.emit("loading",t);s=yield o.fetchBlob(n,i,t);const r=this.options.blobMimeType;r&&(s=new Blob([s],{type:r}))}this.setSrc(n,s);const l=yield new Promise((t=>{const i=h||this.getDuration();i?t(i):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>t(this.getDuration())),{once:!0}))}));if(!n&&!s){const t=this.getMediaElement();t instanceof b&&(t.duration=l)}if(r)this.decodedData=i.createBuffer(r,l||0);else if(s){const t=yield s.arrayBuffer();this.decodedData=yield i.decode(t,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(i,n,s){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio(i,void 0,n,s)}catch(t){throw this.emit("error",t),t}}))}loadBlob(i,n,s){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",i,n,s)}catch(t){throw this.emit("error",t),t}}))}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:i=8e3,precision:n=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const s=Math.min(t,this.decodedData.numberOfChannels),r=[];for(let t=0;t<s;t++){const s=this.decodedData.getChannelData(t),o=[],h=s.length/i;for(let t=0;t<i;t++){const i=s.slice(Math.floor(t*h),Math.ceil((t+1)*h));let r=0;for(let t=0;t<i.length;t++){const n=i[t];Math.abs(n)>Math.abs(r)&&(r=n)}o.push(Math.round(r*n)/n)}r.push(o)}return r}getDuration(){let t=super.getDuration()||0;return 0!==t&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const i=this.getDuration()*t;this.setTime(i)}play(i,n){const s=Object.create(null,{play:{get:()=>super.play}});return t(this,void 0,void 0,(function*(){null!=i&&this.setTime(i);const t=yield s.play.call(this);return null!=n&&(this.media instanceof b?this.media.stopAt(n):this.stopAtPosition=n),t}))}playPause(){return t(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return t(this,arguments,void 0,(function*(t="image/png",i=1,n="dataURL"){return this.renderer.exportImage(t,i,n)}))}destroy(){var t;this.emit("destroy"),null===(t=this.abortController)||void 0===t||t.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}C.BasePlugin=class extends e{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},C.dom=r;export{C as default};

